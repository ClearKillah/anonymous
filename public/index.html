<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Anon Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="styles.css">
  
  <style>
    /* –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç–∏–ª–∏ –≤ —Å–µ–∫—Ü–∏—é <style> –≤ index.html –∏–ª–∏ –≤ styles.css */

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
html, body {
  position: fixed;
  width: 100%;
  height: 100%;
  height: -webkit-fill-available;
  overflow: hidden;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  overscroll-behavior: none;
}

#mainWrapper {
  width: 100%;
  height: 100%;
  height: -webkit-fill-available;
  display: flex;
  flex-direction: column;
  padding: 0;
  margin: 0;
  overflow: hidden;
}

/* –î–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
#profileForm, #chatContainer {
  height: 100%;
  width: 100%;
  box-sizing: border-box;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

#chat {
  padding-bottom: calc(60px + env(safe-area-inset-bottom));
}

#inputArea {
  padding-bottom: calc(6px + env(safe-area-inset-bottom));
}

/* –ö–ª–∞—Å—Å, –¥–æ–±–∞–≤–ª—è–µ–º—ã–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ */
.app-ready {
  transition: opacity 0.3s ease;
  opacity: 1;
}

/* –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –º–µ—Ä—Ü–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
body:not(.app-ready) {
  opacity: 0.98;
}

/* –§–∏–∫—Å –¥–ª—è iOS Safari */
@supports (-webkit-touch-callout: none) {
  .chat-area {
    height: -webkit-fill-available;
  }
  
  #inputArea {
    /* –í–∞–∂–Ω—ã–π —Ñ–∏–∫—Å –¥–ª—è iOS –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã */
    transform: translate3d(0, 0, 0);
    -webkit-transform: translate3d(0, 0, 0);
    will-change: transform;
  }
}
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      width: 100%;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #000);
      -webkit-user-select: none;
      user-select: none;
      overscroll-behavior: none;
      height: 100vh;
      height: -webkit-fill-available;
      overflow-x: hidden;
      position: fixed; /* –í–∞–∂–Ω–æ –¥–ª—è iOS */
      width: 100%; /* –í–∞–∂–Ω–æ –¥–ª—è iOS */
      padding-top: env(safe-area-inset-top);
    }

    #mainWrapper {
      width: 100%;
      height: 100%;
      height: -webkit-fill-available;
      display: flex;
      flex-direction: column;
      padding-top: 0;
    }

    /* Profile Form */
    #profileForm {
      padding: 16px 16px calc(16px + env(safe-area-inset-bottom));
      background: var(--tg-theme-bg-color, #fff);
      animation: fadeIn 0.3s ease;
      padding-top: 0;
      height: 100%;
      overflow-y: auto;
    }
    
    #profileForm h3 {
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 600;
      color: var(--tg-theme-text-color, #000);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #profileForm h3::before {
      content: "üí≠";
      font-size: 24px;
    }
    
    .input-group {
      margin-bottom: 20px;
      animation: slideUp 0.3s ease;
      animation-fill-mode: both;
    }
    
    .input-group:nth-child(2) { animation-delay: 0.1s; }
    .input-group:nth-child(3) { animation-delay: 0.2s; }
    .input-group:nth-child(4) { animation-delay: 0.3s; }
    
    .label {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #999);
      margin-bottom: 8px;
      display: block;
      font-weight: 500;
    }
    
    #profileForm input {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 4px;
      border: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
      border-radius: 10px;
      font-size: 16px;
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      color: var(--tg-theme-text-color, #000);
      transition: all 0.2s ease;
      -webkit-appearance: none; /* –í–∞–∂–Ω–æ –¥–ª—è iOS */
    }

    #profileForm input:focus {
      border-color: var(--tg-theme-button-color, #2481cc);
      background: var(--tg-theme-bg-color, #fff);
      outline: none;
    }

    /* Gender Buttons */
    #genderButtons {
      display: flex;
      gap: 8px;
      margin-bottom: 4px;
    }
    
    .gender-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
      font-size: 16px;
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      color: var(--tg-theme-text-color, #000);
      transition: all 0.2s ease;
      -webkit-touch-callout: none;
    }
    
    .gender-btn[data-value="m"] {
      background: rgba(0, 122, 255, 0.1);
      border-color: rgba(0, 122, 255, 0.2);
      color: #007AFF;
    }
    
    .gender-btn[data-value="f"] {
      background: rgba(255, 45, 85, 0.1);
      border-color: rgba(255, 45, 85, 0.2);
      color: #FF2D55;
    }
    
    .gender-btn[data-value="m"].active {
      background: #007AFF;
      border-color: #007AFF;
      color: #fff;
    }
    
    .gender-btn[data-value="f"].active {
      background: #FF2D55;
      border-color: #FF2D55;
      color: #fff;
    }

    /* Interests */
    #interestsContainer {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 4px;
    }
    
    .interest-btn {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      color: var(--tg-theme-text-color, #000);
      font-size: 14px;
      transition: all 0.2s ease;
      -webkit-touch-callout: none;
    }
    
    .interest-btn.active {
      background: var(--tg-theme-button-color, #2481cc);
      border-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #fff);
    }

    /* Main button */
    #saveProfileBtn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #fff);
      font-size: 16px;
      font-weight: 500;
      padding: 14px;
      border-radius: 10px;
      border: none;
      width: 100%;
      -webkit-touch-callout: none;
    }

    /* Chat Container */
    #chatContainer {
      flex: 1;
      display: none;
      flex-direction: column;
      height: 100%;
      position: relative;
      overflow: hidden;
      padding-top: 0;
      height: 100%;
    }
    
    #partnerInfo {
      padding: 12px 16px;
      border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--tg-theme-bg-color, #fff);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      z-index: 10;
      position: relative;
    }
    
    #skipBtn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #fff);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
    }

    #skipBtn:active {
      transform: scale(0.95);
      opacity: 0.8;
    }

    /* Chat Area */
    #chat {
      flex: 1;
      height: calc(100vh - 100px); /* –í—ã—Å–æ—Ç–∞ –º–∏–Ω—É—Å —Ö–µ–¥–µ—Ä –∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞ */
      padding: 16px;
      padding-bottom: calc(60px + env(safe-area-inset-bottom));
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      position: relative;
      background: var(--tg-theme-bg-color, #fff);
    }
    
    #chat::-webkit-scrollbar {
      width: 4px;
    }

    #chat::-webkit-scrollbar-track {
      background: transparent;
    }

    #chat::-webkit-scrollbar-thumb {
      background: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.2));
      border-radius: 2px;
    }
    
    .system-message {
      text-align: center;
      color: var(--tg-theme-hint-color, #999);
      font-size: 14px;
      margin: 8px 0;
      padding: 4px 12px;
      border-radius: 10px;
      background: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05));
      display: inline-block;
      margin-left: auto;
      margin-right: auto;
    }
    
    .chat-msg {
      opacity: 0;
      transform: translateY(10px);
      animation: slideUpFade 0.3s ease forwards;
    }
    
    .my-message,
    .partner-message {
      max-width: 80%;
      padding: 12px 16px;
      margin: 4px 0;
      border-radius: 18px;
      font-size: 15px;
      line-height: 1.4;
      position: relative;
      word-break: break-word;
      white-space: pre-wrap;
    }
    
    .my-message {
      margin-left: auto;
      border-bottom-right-radius: 4px;
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #fff);
    }
    
    .partner-message {
      margin-right: auto;
      border-bottom-left-radius: 4px;
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      color: var(--tg-theme-text-color, #000);
    }

    /* Input Area */
    #inputArea {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      min-height: 48px;
      background: var(--tg-theme-bg-color, #fff);
      border-top: 1px solid var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.1));
      padding: 6px 8px;
      padding-bottom: calc(6px + env(safe-area-inset-bottom));
      display: flex;
      align-items: flex-end;
      gap: 8px;
      z-index: 1000;
      transform: translateZ(0);
      -webkit-transform: translateZ(0);
      transition: transform 0.3s ease;
      will-change: transform;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
    }
    
    #messageInput {
      flex: 1;
      min-height: 36px;
      max-height: 150px;
      padding: 9px 12px;
      border: none;
      border-radius: 18px;
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      font-size: 16px;
      line-height: 20px;
      color: var(--tg-theme-text-color, #000);
      resize: none;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      -webkit-appearance: none; /* –í–∞–∂–Ω–æ –¥–ª—è iOS */
    }
    
    #messageInput:focus {
      outline: none;
    }

    /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Å—Ç–∏–ª–µ Telegram */
    #sendBtn {
      width: 36px;
      height: 36px;
      padding: 0;
      border: none;
      border-radius: 50%;
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #fff);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-bottom: 0;
      transition: opacity 0.15s ease;
    }

    #sendBtn:active {
      opacity: 0.7;
    }

    /* Typing indicator */
    .typing-indicator {
      padding: 6px 12px;
      border-radius: 10px;
      background: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05));
      color: var(--tg-theme-hint-color, #999);
      font-size: 13px;
      margin-right: auto;
      margin-bottom: 4px;
      display: none;
    }

    .typing-indicator.visible {
      display: inline-flex;
      align-items: center;
    }

    .typing-dots {
      display: inline-flex;
      margin-left: 4px;
    }

    .typing-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--tg-theme-hint-color, #999);
      margin: 0 1px;
      animation: typingAnimation 1.4s infinite;
      opacity: 0.6;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    /* Report button */
    #reportBtn {
      font-size: 13px;
      color: var(--tg-theme-hint-color, #999);
      background: none;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      margin-right: 10px;
    }

    /* Report modal */
    #reportModal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }

    .modal-content {
      width: 90%;
      max-width: 320px;
      background: var(--tg-theme-bg-color, #fff);
      border-radius: 12px;
      overflow: hidden;
      animation: scaleIn 0.2s ease;
    }

    .modal-header {
      padding: 16px;
      border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
      text-align: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    .modal-body {
      padding: 16px;
    }

    .report-option {
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      color: var(--tg-theme-text-color, #000);
    }

    .report-option:last-child {
      margin-bottom: 0;
    }

    .report-option.selected {
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #fff);
    }

    .modal-footer {
      display: flex;
      border-top: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
    }

    .modal-btn {
      flex: 1;
      padding: 14px;
      border: none;
      background: none;
      font-size: 16px;
      font-weight: 500;
    }

    .modal-btn.cancel {
      color: var(--tg-theme-text-color, #000);
      border-right: 1px solid var(--tg-theme-secondary-bg-color, #f0f0f0);
    }

    .modal-btn.confirm {
      color: #FF3B30;
    }

    .modal-btn.disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    /* iOS specific styles */
    @supports (-webkit-touch-callout: none) {
      #inputArea {
        position: fixed;
      }
    }

    /* Desktop styles */
    @media (min-width: 769px) {
      #chatContainer {
        padding-bottom: 0;
      }

      #chat {
        position: relative;
        top: 0;
        padding-bottom: 16px;
      }
      
      #inputArea {
        position: relative;
        padding: 12px;
        bottom: 0;
      }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUpFade {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes typingAnimation {
      0%, 100% { opacity: 0.2; transform: translateY(0); }
      50% { opacity: 0.8; transform: translateY(-2px); }
    }

    /* –£–¥–∞–ª—è–µ–º ripple —ç—Ñ—Ñ–µ–∫—Ç */
    .ripple::after {
      display: none;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
    .message-time {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }

    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω–∞ */
    .online-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4CAF50;
      display: inline-block;
      margin-right: 6px;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è placeholder */
    #messageInput::placeholder {
      color: var(--tg-theme-hint-color, #999);
      opacity: 0.7;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    .unread-messages {
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
      color: var(--tg-theme-button-color, #2481cc);
      font-size: 13px;
      padding: 4px 12px;
      border-radius: 12px;
      margin: 8px auto;
      text-align: center;
      width: fit-content;
    }
  </style>
</head>
<body>
  <div id="mainWrapper">
    <!-- Profile Form -->
    <div id="profileForm">
      <h3>–ê–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</h3>

      <span class="label">–ù–∏–∫–Ω–µ–π–º</span>
      <input
        type="text"
        id="nickname"
        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º"
        autocomplete="off"
        autocorrect="off"
        spellcheck="false"
      />

      <span class="label">–ü–æ–ª</span>
      <div id="genderButtons">
        <button class="gender-btn" data-value="m">–ú—É–∂—Å–∫–æ–π</button>
        <button class="gender-btn" data-value="f">–ñ–µ–Ω—Å–∫–∏–π</button>
      </div>

      <span class="label">–í–æ–∑—Ä–∞—Å—Ç</span>
      <input
        id="age"
        type="number"
        placeholder="–£–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç"
        inputmode="numeric"
        pattern="[0-9]*"
      />

      <span class="label">–ò–Ω—Ç–µ—Ä–µ—Å—ã</span>
      <div id="interestsContainer">
        <button class="interest-btn" data-value="–û–±—â–µ–Ω–∏–µ">–û–±—â–µ–Ω–∏–µ</button>
        <button class="interest-btn" data-value="–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞">–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞</button>
        <button class="interest-btn" data-value="–î—Ä—É–∂–±–∞">–î—Ä—É–∂–±–∞</button>
        <button class="interest-btn" data-value="–ò–≥—Ä—ã">–ò–≥—Ä—ã</button>
        <button class="interest-btn" data-value="–ú—É–∑—ã–∫–∞">–ú—É–∑—ã–∫–∞</button>
        <button class="interest-btn" data-value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</button>
        <button class="interest-btn" data-value="–ö–∏–Ω–æ">–ö–∏–Ω–æ</button>
        <button class="interest-btn" data-value="–ö–Ω–∏–≥–∏">–ö–Ω–∏–≥–∏</button>
        <button class="interest-btn" data-value="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
      </div>

      <button id="saveProfileBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫
      </button>
    </div>

    <!-- Chat -->
    <div id="chatContainer">
      <div id="partnerInfo">
        <span id="partnerLabel">–ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...</span>
        <div class="partner-actions">
          <button id="reportBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
          </button>
          <button id="skipBtn">–°–ª–µ–¥—É—é—â–∏–π</button>
        </div>
      </div>
      <div id="chat">
        <div class="system-message chat-msg">–ò—â–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...</div>
      </div>
      <div class="typing-indicator" id="typingIndicator">
        –ü–µ—á–∞—Ç–∞–µ—Ç<span class="typing-dots">
          <span class="typing-dot"></span>
          <span class="typing-dot"></span>
          <span class="typing-dot"></span>
        </span>
      </div>
      <div id="inputArea">
        <textarea id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" rows="1"></textarea>
        <button id="sendBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div id="reportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</h3>
      </div>
      <div class="modal-body">
        <div class="report-option" data-reason="spam">–°–ø–∞–º</div>
        <div class="report-option" data-reason="offensive">–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è</div>
        <div class="report-option" data-reason="adult">–ù–µ–ø—Ä–∏–µ–º–ª–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</div>
        <div class="report-option" data-reason="other">–î—Ä—É–≥–æ–µ</div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="modal-btn confirm disabled">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞ –≤ index.html, –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π tg
// –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ const tg = window.Telegram.WebApp;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ WebApp –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
const supportsFullscreen = typeof tg.setHeaderColor === 'function' && 
                            typeof tg.setBackgroundColor === 'function' &&
                            typeof tg.enableClosingConfirmation === 'function';

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
function initFullscreenMode() {
  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ–º WebApp
  tg.expand();
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
  if (supportsFullscreen) {
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Telegram (–µ—Å–ª–∏ API –±—É–¥–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å)
    if (typeof tg.enableHeaderControl === 'function') {
      tg.enableHeaderControl();
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ —à–∞–ø–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–µ–π —Ç–µ–º–æ–π
    tg.setHeaderColor(tg.colorScheme === 'dark' ? '#000000' : '#ffffff');
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–º–æ–π
    tg.setBackgroundColor(tg.colorScheme === 'dark' ? '#000000' : '#ffffff');
    
    // –ó–∞–ø—Ä–æ—Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–π –≤—ã—Å–æ—Ç—ã –¥–ª—è WebApp
    if (typeof tg.requestViewport === 'function') {
      tg.requestViewport({
        height: '100%',
        is_expanded: true
      });
    }
    
    // –£–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª –¥–ª—è iOS Safari
    document.documentElement.style.position = 'fixed';
    document.documentElement.style.width = '100%';
    document.documentElement.style.height = '100%';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
    document.body.style.height = '100%';
    
    console.log('Fullscreen mode initialized');
  }
}

// –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ WebApp
tg.onEvent('viewportChanged', () => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –ª–∏ –≤—ã—Å–æ—Ç–∞ viewport
  if (window.innerHeight === tg.viewportHeight) {
    document.body.classList.add('app-ready');
  }
});

// –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ DOMContentLoaded –Ω–∞:

document.addEventListener('DOMContentLoaded', () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Mini App
  tg.ready();
  
  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
  initFullscreenMode();
  
  // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
  tg.enableClosingConfirmation();
  
  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–π –≤–≤–æ–¥
  setupMobileInput();
  
  // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–Ω–∞–∑–∞–¥" –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
  tg.BackButton.hide();
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏...
});
    tg.expand();
    tg.ready();

    const socket = io();

    const mainWrapper = document.getElementById('mainWrapper');
    const profileForm = document.getElementById('profileForm');
    const nicknameInput = document.getElementById('nickname');
    const genderButtons = document.querySelectorAll('.gender-btn');
    let selectedGender = null;

    const ageInput = document.getElementById('age');
    const interestsContainer = document.getElementById('interestsContainer');
    const saveProfileBtn = document.getElementById('saveProfileBtn');

    const chatContainer = document.getElementById('chatContainer');
    const chat = document.getElementById('chat');
    const partnerLabel = document.getElementById('partnerLabel');
    const skipBtn = document.getElementById('skipBtn');
    const reportBtn = document.getElementById('reportBtn');

    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const typingIndicator = document.getElementById('typingIndicator');

    const reportModal = document.getElementById('reportModal');
    const reportOptions = document.querySelectorAll('.report-option');
    const reportCancelBtn = document.querySelector('.modal-btn.cancel');
    const reportConfirmBtn = document.querySelector('.modal-btn.confirm');

    let partnerId = null;
    let selectedInterests = new Set();
    let selectedReportReason = null;
    let typingTimeout = null;

    // Gender selection
    genderButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        genderButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedGender = btn.dataset.value;
      });
    });

    // Interests selection
    interestsContainer.addEventListener('click', (e) => {
      const btn = e.target.closest('.interest-btn');
      if (btn) {
        const val = btn.dataset.value;
        if (selectedInterests.has(val)) {
          selectedInterests.delete(val);
          btn.classList.remove('active');
        } else {
          selectedInterests.add(val);
          btn.classList.add('active');
        }
      }
    });

    // Start button
    saveProfileBtn.addEventListener('click', () => {
      const nickname = nicknameInput.value.trim();
      const gender = selectedGender;
      const age = ageInput.value.trim();

      if (!/^[A-Za-z–ê-–Ø–∞-—è\s]{2,20}$/.test(nickname)) {
        tg.showAlert('–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 2 –¥–æ 20 –±—É–∫–≤');
        return;
      }
      if (!/^\d{1,2}$/.test(age) || age < 18 || age > 99) {
        tg.showAlert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (18-99)');
        return;
      }
      if (!gender) {
        tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª');
        return;
      }
      if (selectedInterests.size === 0) {
        tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä–µ—Å');
        return;
      }

      const interestsArray = Array.from(selectedInterests);

      socket.emit('setProfile', {
        nickname,
        gender,
        age,
        interests: interestsArray
      });

      profileForm.style.display = 'none';
      chatContainer.style.display = 'flex';
      addSystemMessage('üîé –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–Ω–∞–∑–∞–¥"
      tg.BackButton.show();

      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
      tg.setHeaderColor(tg.colorScheme === 'dark' ? '#000000' : '#ffffff');
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å–æ–∫–µ—Ç–æ–≤
    socket.on('connect', () => {
      console.log('Connected to server');
    });

    socket.on('error', (error) => {
      tg.showAlert(error.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
    });

    // –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
    socket.on('waitingForMatch', () => {
      if (!document.querySelector('.system-message:last-child').textContent.includes('–ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞')) {
        addSystemMessage('üîé –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...');
      }
    });

    // Chat ready
    socket.on('chatReady', (data) => {
      partnerId = data.partnerId;
      const p = data.partnerProfile;
      const genderEmoji = p.gender === 'm' ? 'üë®' : 'üë©';
      partnerLabel.innerHTML = `
        <span class="online-indicator"></span>
        ${genderEmoji} ${p.nickname}, ${p.age}
      `;
      addSystemMessage('‚ú® –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω');
      
      // –û—á–∏—â–∞–µ–º —á–∞—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∏—Å–∫–∞
      const messages = document.querySelectorAll('.chat-msg');
      messages.forEach((msg, index) => {
        if (index < messages.length - 1) {
          msg.remove();
        }
      });
      
      messageInput.focus();
      clearTypingIndicator();
    });

    // Receive message
    socket.on('receiveMessage', (msg) => {
      addPartnerMessage(msg.text);
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ —á–∞—Ç–µ
      if (document.visibilityState === 'hidden') {
        tg.HapticFeedback.notificationOccurred('warning');
      }
    });

    // Partner left
    socket.on('partnerLeft', () => {
      const onlineIndicator = document.querySelector('.online-indicator');
      if (onlineIndicator) {
        onlineIndicator.style.background = '#999';
      }
      addSystemMessage('‚ùå –°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç');
      partnerLabel.innerHTML = `
        <span class="online-indicator" style="background: #999;"></span>
        –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...
      `;
      partnerId = null;
      clearTypingIndicator();
    });

    // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    socket.on('inactivityDisconnect', () => {
      addSystemMessage('‚è±Ô∏è –ß–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω –∏–∑-–∑–∞ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏');
      partnerLabel.innerHTML = `
        <span class="online-indicator" style="background: #999;"></span>
        –ü–æ–∏—Å–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...
      `;
      partnerId = null;
      clearTypingIndicator();
    });

    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
    socket.on('partnerTyping', (isTyping) => {
      if (isTyping) {
        typingIndicator.classList.add('visible');
      } else {
        typingIndicator.classList.remove('visible');
      }
    });

    // –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∂–∞–ª–æ–±—ã
    socket.on('reportSuccess', () => {
      tg.showAlert('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–º–æ—â—å!');
    });

    // Send message
    sendBtn.addEventListener('click', sendMessage);
    messageInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Typing indicator
    messageInput.addEventListener('input', () => {
      if (!partnerId) return;
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã textarea
      messageInput.style.height = 'auto';
      messageInput.style.height = Math.min(messageInput.scrollHeight, 150) + 'px';
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞–±–æ—Ä–µ —Ç–µ–∫—Å—Ç–∞
      socket.emit('typing', true);
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
      if (typingTimeout) {
        clearTimeout(typingTimeout);
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
      typingTimeout = setTimeout(() => {
        socket.emit('typing', false);
      }, 2000);
    });

    // Skip button
    skipBtn.addEventListener('click', () => {
      if (partnerId) {
        tg.HapticFeedback.impactOccurred('medium');
        socket.emit('skip');
        addSystemMessage('üîÑ –ü–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞...');
      }
    });

    // Report button
    reportBtn.addEventListener('click', () => {
      if (!partnerId) return;
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç—á–µ—Ç–∞
      reportModal.style.display = 'flex';
      selectedReportReason = null;
      reportOptions.forEach(option => option.classList.remove('selected'));
      reportConfirmBtn.classList.add('disabled');
      
      tg.HapticFeedback.impactOccurred('light');
      tg.expand(); // –ß—Ç–æ–±—ã –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–∞—Å—Ç—è–Ω—É–ª–æ—Å—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    });

    // Report options
    reportOptions.forEach(option => {
      option.addEventListener('click', () => {
        reportOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        selectedReportReason = option.dataset.reason;
        reportConfirmBtn.classList.remove('disabled');
        tg.HapticFeedback.impactOccurred('light');
      });
    });

    // Report modal buttons
    reportCancelBtn.addEventListener('click', () => {
      reportModal.style.display = 'none';
      tg.HapticFeedback.impactOccurred('light');
    });

    reportConfirmBtn.addEventListener('click', () => {
      if (selectedReportReason && partnerId) {
        socket.emit('reportUser', { reason: selectedReportReason });
        reportModal.style.display = 'none';
        tg.HapticFeedback.notificationOccurred('success');
      }
    });

    // Close modal when clicking outside
    reportModal.addEventListener('click', (e) => {
      if (e.target === reportModal) {
        reportModal.style.display = 'none';
      }
    });

    function sendMessage() {
      const text = messageInput.value.trim();
      if (!text || !partnerId) return;
      
      socket.emit('sendMessage', text);
      addMyMessage(text);
      messageInput.value = '';
      messageInput.style.height = '36px'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞
      if (typingTimeout) {
        clearTimeout(typingTimeout);
      }
      socket.emit('typing', false);
      
      // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
      tg.HapticFeedback.impactOccurred('light');
      
      if (window.innerWidth > 768) {
        messageInput.focus();
      }
    }

    // Desktop auto-focus
    if (window.innerWidth > 768) {
      chat.addEventListener('click', () => {
        messageInput.focus();
      });
    }

    // Message utilities
    function addMyMessage(text) {
      const div = document.createElement('div');
      div.className = 'my-message chat-msg';
      
      // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
      const messageText = document.createElement('div');
      messageText.className = 'message-text';
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏
      const formattedText = formatMessageText(text);
      messageText.innerHTML = formattedText;
      div.appendChild(messageText);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è
      const timeDiv = document.createElement('div');
      timeDiv.className = 'message-time';
      timeDiv.textContent = formatTime(new Date());
      div.appendChild(timeDiv);
      
      chat.appendChild(div);
      scrollChatToBottom();
    }

    function addPartnerMessage(text) {
      const div = document.createElement('div');
      div.className = 'partner-message chat-msg';
      
      // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
      const messageText = document.createElement('div');
      messageText.className = 'message-text';
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏
      const formattedText = formatMessageText(text);
      messageText.innerHTML = formattedText;
      div.appendChild(messageText);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è
      const timeDiv = document.createElement('div');
      timeDiv.className = 'message-time';
      timeDiv.textContent = formatTime(new Date());
      div.appendChild(timeDiv);
      
      chat.appendChild(div);
      scrollChatToBottom();
    }

    function addSystemMessage(text) {
      const div = document.createElement('div');
      div.className = 'system-message chat-msg';
      div.innerHTML = text;
      chat.appendChild(div);
      scrollChatToBottom();
    }

    function formatMessageText(text) {
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" style="color: inherit; text-decoration: underline;">$1</a>')
        .replace(/\n/g, '<br>');
    }

    function formatTime(date) {
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function clearTypingIndicator() {
      typingIndicator.classList.remove('visible');
      if (typingTimeout) {
        clearTimeout(typingTimeout);
        typingTimeout = null;
      }
    }

    function scrollChatToBottom() {
      // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
      setTimeout(() => {
        chat.scrollTop = chat.scrollHeight;
      }, 10);
    }

    // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞
    function setupMobileInput() {
      const inputArea = document.getElementById('inputArea');
      const messageInput = document.getElementById('messageInput');
      const chat = document.getElementById('chat');
      let keyboardVisible = false;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ visualViewport API
      const hasVisualViewport = window.visualViewport !== undefined;
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã textarea
      function updateTextareaHeight() {
        messageInput.style.height = 'auto';
        messageInput.style.height = Math.min(messageInput.scrollHeight, 150) + 'px';
      }
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã
      messageInput.addEventListener('input', updateTextareaHeight);
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ visualViewport –¥–ª—è iOS –∏ –Ω–æ–≤—ã—Ö Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      if (hasVisualViewport) {
        window.visualViewport.addEventListener('resize', () => {
          const currentHeight = window.visualViewport.height;
          const heightDiff = window.innerHeight - currentHeight;
          
          // –ï—Å–ª–∏ –≤—ã—Å–æ—Ç–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ - —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –æ—Ç–∫—Ä—ã–ª–∞—Å—å
          if (heightDiff > 150) { 
            keyboardVisible = true;
            
            // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ - –º–µ–Ω—è–µ–º position –Ω–∞ absolute –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
            inputArea.style.position = 'absolute';
            
            // –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∫ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            inputArea.style.bottom = `${heightDiff}px`;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
            setTimeout(() => {
              chat.scrollTop = chat.scrollHeight;
            }, 100);
          } else {
            keyboardVisible = false;
            inputArea.style.position = 'fixed';
            inputArea.style.bottom = '0';
          }
        });
        
        // –≠—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–∞–∂–µ–Ω –¥–ª—è iOS, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
        window.visualViewport.addEventListener('scroll', () => {
          if (keyboardVisible) {
            inputArea.style.bottom = `${window.visualViewport.offsetTop}px`;
          }
        });
      } else {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—ã—Ç–∏—è —Ñ–æ–∫—É—Å–∞
        messageInput.addEventListener('focus', () => {
          // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è iOS, —á—Ç–æ–±—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É—Å–ø–µ–ª–∞ –ø–æ—è–≤–∏—Ç—å—Å—è
          setTimeout(() => {
            window.scrollTo(0, 0);
            document.body.scrollTop = 0;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑
            chat.scrollTop = chat.scrollHeight;
          }, 300);
        });
      }
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø—É—Å—Ç–æ–π —á–∞—Å—Ç–∏ —á–∞—Ç–∞ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
      chat.addEventListener('click', (e) => {
        if (e.target === chat) {
          messageInput.blur();
        }
      });
      
      // –ü—Ä–∏ —Ä–µ—Å–∞–π–∑–µ –æ–∫–Ω–∞ - –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
      window.addEventListener('resize', () => {
        if (keyboardVisible) {
          chat.scrollTop = chat.scrollHeight;
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–Ω–∞–∑–∞–¥"
    tg.BackButton.onClick(() => {
      if (chatContainer.style.display === 'flex') {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        if (reportModal.style.display === 'flex') {
          reportModal.style.display = 'none';
          return;
        }
        
        // –ï—Å–ª–∏ –º—ã –≤ —á–∞—Ç–µ, —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –æ –≤—ã—Ö–æ–¥–µ
        tg.showConfirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —á–∞—Ç–∞?', (confirmed) => {
          if (confirmed) {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–æ—Ñ–∏–ª—é
            chatContainer.style.display = 'none';
            profileForm.style.display = 'block';
            
            // –û—Ç–∫–ª—é—á–∞–µ–º—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞
            if (partnerId) {
              socket.emit('skip');
              partnerId = null;
            }
            
            // –û—á–∏—â–∞–µ–º —á–∞—Ç
            chat.innerHTML = '';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            messageInput.value = '';
            messageInput.style.height = '36px';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–Ω–∞–∑–∞–¥" –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
            tg.BackButton.hide();
          }
        });
      } else {
        // –ï—Å–ª–∏ –º—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ, —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –æ –∑–∞–∫—Ä—ã—Ç–∏–∏
        tg.showConfirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?', (confirmed) => {
          if (confirmed) {
            tg.close();
          }
        });
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Mini App
      tg.ready();
      tg.expand();
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ö–µ–¥–µ—Ä–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–º–æ–π
      tg.setHeaderColor(tg.colorScheme === 'dark' ? '#000000' : '#ffffff');
      
      // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
      tg.enableClosingConfirmation();
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–π –≤–≤–æ–¥
      setupMobileInput();
      
      // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–Ω–∞–∑–∞–¥" –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
      tg.BackButton.hide();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible' && partnerId) {
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          socket.emit('heartbeat');
        }
      });
    });

    // –î–ª—è iOS - –æ—Å–æ–±—ã–π —Ö–∞–∫ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç—ã
    document.documentElement.style.height = '100%';
    document.body.style.height = '100%';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
  </script>
</body>
</html>
